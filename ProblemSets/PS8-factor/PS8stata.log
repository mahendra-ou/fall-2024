--------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/mahendraj/Desktop/Econ 6343 Metrics III/fall-2024-1/ProblemSets/PS8-factor/PS8stata.log
  log type:  text
 opened on:  27 Oct 2024, 15:00:01

. 
. import delimited "nlsy.csv", clear
(15 vars, 2,438 obs)

. 
. ***************************************************************************
. * Q1. Basic regression model
. reg logwage black hispanic female schoolt gradhs grad4yr, robust

Linear regression                               Number of obs     =      2,438
                                                F(6, 2431)        =      68.59
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1465
                                                Root MSE          =     .47745

------------------------------------------------------------------------------
             |               Robust
     logwage | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       black |  -.1674411   .0244938    -6.84   0.000     -.215472   -.1194101
    hispanic |   -.054249   .0239325    -2.27   0.023    -.1011792   -.0073188
      female |  -.1550492     .01993    -7.78   0.000    -.1941308   -.1159676
     schoolt |    .005251   .0050374     1.04   0.297     -.004627    .0151291
      gradhs |   .1956485   .0439858     4.45   0.000      .109395     .281902
     grad4yr |   .2991313   .0279161    10.72   0.000     .2443895    .3538732
       _cons |   2.007713   .0434707    46.19   0.000      1.92247    2.092956
------------------------------------------------------------------------------

. 
. * Q2. Correlation matrix of ASVAB variables
. correlate asvab*
(obs=2,438)

             |  asvabar  asvabcs  asvabmk  asvabno  asvabpc  asvabwk
-------------+------------------------------------------------------
     asvabar |   1.0000
     asvabcs |   0.4773   1.0000
     asvabmk |   0.7993   0.5461   1.0000
     asvabno |   0.5445   0.5546   0.6383   1.0000
     asvabpc |   0.7090   0.5005   0.7167   0.5168   1.0000
     asvabwk |   0.6772   0.4220   0.6724   0.4619   0.7454   1.0000


. 
. * Q3. Regression with all ASVAB variables
. reg logwage black hispanic female schoolt gradhs grad4yr asvab*, robust

Linear regression                               Number of obs     =      2,438
                                                F(12, 2425)       =      42.44
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1793
                                                Root MSE          =     .46875

------------------------------------------------------------------------------
             |               Robust
     logwage | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       black |  -.0882104    .027166    -3.25   0.001    -.1414813   -.0349395
    hispanic |    -.00266   .0243742    -0.11   0.913    -.0504563    .0451363
      female |  -.1500825   .0203189    -7.39   0.000    -.1899267   -.1102382
     schoolt |  -.0021059   .0050291    -0.42   0.675    -.0119677     .007756
      gradhs |   .1150218   .0449957     2.56   0.011     .0267877    .2032558
     grad4yr |    .235114   .0282132     8.33   0.000     .1797896    .2904384
     asvabar |   .0448741   .0173734     2.58   0.010     .0108059    .0789423
     asvabcs |   .0119797   .0126642     0.95   0.344     -.012854    .0368135
     asvabmk |   .0800608   .0175603     4.56   0.000      .045626    .1144955
     asvabno |   .0064872   .0133174     0.49   0.626    -.0196274    .0326019
     asvabpc |  -.0218555   .0174585    -1.25   0.211    -.0560905    .0123796
     asvabwk |   .0018674   .0160459     0.12   0.907    -.0295978    .0333325
       _cons |   2.114387    .045435    46.54   0.000     2.025291    2.203482
------------------------------------------------------------------------------

. ***************************************************************************
. * Q4. PCA Analysis
. * First, conduct PCA on ASVAB variables
. pca asvab*

Principal components/correlation                 Number of obs    =      2,438
                                                 Number of comp.  =          6
                                                 Trace            =          6
    Rotation: (unrotated = principal)            Rho              =     1.0000

    --------------------------------------------------------------------------
       Component |   Eigenvalue   Difference         Proportion   Cumulative
    -------------+------------------------------------------------------------
           Comp1 |      4.02084      3.28742             0.6701       0.6701
           Comp2 |      .733419      .272949             0.1222       0.7924
           Comp3 |       .46047      .109076             0.0767       0.8691
           Comp4 |      .351394      .105736             0.0586       0.9277
           Comp5 |      .245658     .0574414             0.0409       0.9686
           Comp6 |      .188217            .             0.0314       1.0000
    --------------------------------------------------------------------------

Principal components (eigenvectors) 

    ----------------------------------------------------------------------------------------
        Variable |    Comp1     Comp2     Comp3     Comp4     Comp5     Comp6 | Unexplained 
    -------------+------------------------------------------------------------+-------------
         asvabar |   0.4332   -0.2265   -0.1666   -0.5873    0.1036    0.6144 |           0 
         asvabcs |   0.3464    0.6537    0.6526   -0.1247    0.0996    0.0377 |           0 
         asvabmk |   0.4490   -0.0527   -0.2206   -0.3868    0.0382   -0.7720 |           0 
         asvabno |   0.3726    0.5091   -0.6353    0.4179   -0.0089    0.1537 |           0 
         asvabpc |   0.4302   -0.2799    0.2201    0.2620   -0.7863    0.0362 |           0 
         asvabwk |   0.4086   -0.4255    0.2136    0.4966    0.5996   -0.0135 |           0 
    ----------------------------------------------------------------------------------------

. * Predict first principal component
. predict pc1, score
(5 components skipped)

Scoring coefficients 
    sum of squares(column-loading) = 1

    --------------------------------------------------------------------------
        Variable |    Comp1     Comp2     Comp3     Comp4     Comp5     Comp6 
    -------------+------------------------------------------------------------
         asvabar |   0.4332   -0.2265   -0.1666   -0.5873    0.1036    0.6144 
         asvabcs |   0.3464    0.6537    0.6526   -0.1247    0.0996    0.0377 
         asvabmk |   0.4490   -0.0527   -0.2206   -0.3868    0.0382   -0.7720 
         asvabno |   0.3726    0.5091   -0.6353    0.4179   -0.0089    0.1537 
         asvabpc |   0.4302   -0.2799    0.2201    0.2620   -0.7863    0.0362 
         asvabwk |   0.4086   -0.4255    0.2136    0.4966    0.5996   -0.0135 
    --------------------------------------------------------------------------

. * Run regression with first principal component
. reg logwage black hispanic female schoolt gradhs grad4yr pc1, robust

Linear regression                               Number of obs     =      2,438
                                                F(7, 2430)        =      70.50
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1720
                                                Root MSE          =     .47035

------------------------------------------------------------------------------
             |               Robust
     logwage | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       black |  -.0938186   .0257994    -3.64   0.000    -.1444097   -.0432275
    hispanic |  -.0019038   .0242428    -0.08   0.937    -.0494425    .0456349
      female |   -.160304   .0196979    -8.14   0.000    -.1989305   -.1216775
     schoolt |  -.0019612   .0050716    -0.39   0.699    -.0119063    .0079838
      gradhs |   .1078226   .0456781     2.36   0.018     .0182505    .1973948
     grad4yr |   .2423972   .0283078     8.56   0.000     .1868872    .2979071
         pc1 |   .0524384   .0059233     8.85   0.000     .0408232    .0640536
       _cons |   2.124029   .0462021    45.97   0.000     2.033429    2.214629
------------------------------------------------------------------------------

. **************************************************************************
. 
. * Q5. Factor Analysis
. * Conduct factor analysis on ASVAB variables
. factor asvab*, factors(1)
(obs=2,438)

Factor analysis/correlation                      Number of obs    =      2,438
    Method: principal factors                    Retained factors =          1
    Rotation: (unrotated)                        Number of params =          6

    --------------------------------------------------------------------------
         Factor  |   Eigenvalue   Difference        Proportion   Cumulative
    -------------+------------------------------------------------------------
        Factor1  |      3.63783      3.40873            1.0244       1.0244
        Factor2  |      0.22910      0.19235            0.0645       1.0889
        Factor3  |      0.03674      0.13357            0.0103       1.0993
        Factor4  |     -0.09683      0.01568           -0.0273       1.0720
        Factor5  |     -0.11251      0.03066           -0.0317       1.0403
        Factor6  |     -0.14317            .           -0.0403       1.0000
    --------------------------------------------------------------------------
    LR test: independent vs. saturated:  chi2(15) = 9287.43 Prob>chi2 = 0.0000

Factor loadings (pattern matrix) and unique variances

    ---------------------------------------
        Variable |  Factor1 |   Uniqueness 
    -------------+----------+--------------
         asvabar |   0.8440 |      0.2876  
         asvabcs |   0.6176 |      0.6185  
         asvabmk |   0.8838 |      0.2188  
         asvabno |   0.6807 |      0.5367  
         asvabpc |   0.8319 |      0.3080  
         asvabwk |   0.7794 |      0.3926  
    ---------------------------------------

. * Predict factor score
. predict factor1
(option regression assumed; regression scoring)

Scoring coefficients (method = regression)

    ------------------------
        Variable |  Factor1 
    -------------+----------
         asvabar |  0.21210 
         asvabcs |  0.09747 
         asvabmk |  0.31648 
         asvabno |  0.11907 
         asvabpc |  0.22669 
         asvabwk |  0.15783 
    ------------------------


. * Run regression with factor score
. reg logwage black hispanic female schoolt gradhs grad4yr factor1, robust

Linear regression                               Number of obs     =      2,438
                                                F(7, 2430)        =      71.14
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1733
                                                Root MSE          =     .46998

------------------------------------------------------------------------------
             |               Robust
     logwage | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       black |   -.089166   .0258788    -3.45   0.001    -.1399128   -.0384192
    hispanic |  -.0006801   .0242364    -0.03   0.978    -.0482062    .0468461
      female |  -.1583984   .0196583    -8.06   0.000    -.1969472   -.1198497
     schoolt |  -.0023435   .0050663    -0.46   0.644    -.0122782    .0075912
      gradhs |   .1065983   .0455154     2.34   0.019     .0173453    .1958514
     grad4yr |   .2403493   .0283035     8.49   0.000     .1848479    .2958508
     factor1 |    .113546   .0125458     9.05   0.000     .0889444    .1381476
       _cons |   2.125637   .0460101    46.20   0.000     2.035414     2.21586
------------------------------------------------------------------------------

. ***************************************************************************
. 
. * Q6. Maximum Likelihood Estimation of measurement system
. 
. * First, standardize ASVAB variables for better convergence
. foreach var of varlist asvab* {
  2.     egen std_`var' = std(`var')
  3. }

. 
. * Estimate the measurement system using GSEM
. gsem (std_asvab* <- black hispanic female ability@1) ///
>      (logwage <- black hispanic female schoolt gradhs grad4yr ability), ///
>      latent(ability) ///
>      cov(ability*ability@1) ///
>      method(ml) difficult

Fitting fixed-effects model:

Iteration 0:  Log likelihood = -21396.454  
Iteration 1:  Log likelihood = -21396.454  

Refining starting values:

Grid node 0:  Log likelihood =  -18101.25

Fitting full model:

Iteration 0:  Log likelihood =  -18101.25  
Iteration 1:  Log likelihood = -17987.977  
Iteration 2:  Log likelihood = -17857.535  
Iteration 3:  Log likelihood = -17851.867  
Iteration 4:  Log likelihood = -17851.844  
Iteration 5:  Log likelihood = -17851.844  

Generalized structural equation model                    Number of obs = 2,438

Response         : std_asvabar
Family           : Gaussian
Link             : identity

Response         : std_asvabcs
Family           : Gaussian
Link             : identity

Response         : std_asvabmk
Family           : Gaussian
Link             : identity

Response         : std_asvabno
Family           : Gaussian
Link             : identity

Response         : std_asvabpc
Family           : Gaussian
Link             : identity

Response         : std_asvabwk
Family           : Gaussian
Link             : identity

Response         : logwage
Family           : Gaussian
Link             : identity

Log likelihood = -17851.844

 ( 1)  [std_asvabar]ability = 1
 ( 2)  [std_asvabcs]ability = 1
 ( 3)  [std_asvabmk]ability = 1
 ( 4)  [std_asvabno]ability = 1
 ( 5)  [std_asvabpc]ability = 1
 ( 6)  [std_asvabwk]ability = 1
 ( 7)  [var(ability)]_cons = 1
-----------------------------------------------------------------------------------
                  | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
------------------+----------------------------------------------------------------
std_asvabar       |
            black |  -.9363293   .0556306   -16.83   0.000    -1.045363   -.8272954
         hispanic |  -.6798175   .0588465   -11.55   0.000    -.7951545   -.5644804
           female |  -.0167575   .0452849    -0.37   0.711    -.1055144    .0719993
          ability |          1  (constrained)
            _cons |   .3618085   .0364901     9.92   0.000     .2902892    .4333278
------------------+----------------------------------------------------------------
std_asvabcs       |
            black |  -.4309737   .0636714    -6.77   0.000    -.5557673   -.3061801
         hispanic |  -.4427523   .0673522    -6.57   0.000    -.5747601   -.3107445
           female |    .399414   .0518304     7.71   0.000     .2978283    .5009997
          ability |          1  (constrained)
            _cons |   -.003017   .0417644    -0.07   0.942    -.0848737    .0788396
------------------+----------------------------------------------------------------
std_asvabmk       |
            black |   -.809817   .0550012   -14.72   0.000    -.9176172   -.7020167
         hispanic |  -.6376659   .0581807   -10.96   0.000     -.751698   -.5236338
           female |   .1954046   .0447726     4.36   0.000      .107652    .2831572
          ability |          1  (constrained)
            _cons |   .2220797   .0360773     6.16   0.000     .1513696    .2927898
------------------+----------------------------------------------------------------
std_asvabno       |
            black |  -.3418862   .0616773    -5.54   0.000    -.4627715   -.2210009
         hispanic |  -.4675659   .0652428    -7.17   0.000    -.5954394   -.3396923
           female |   .2531868   .0502071     5.04   0.000     .1547826     .351591
          ability |          1  (constrained)
            _cons |   .0513019   .0404564     1.27   0.205    -.0279911    .1305949
------------------+----------------------------------------------------------------
std_asvabpc       |
            black |   -.761979   .0569311   -13.38   0.000    -.8735619   -.6503961
         hispanic |    -.59778   .0602222    -9.93   0.000    -.7158133   -.4797466
           female |   .2997907   .0463436     6.47   0.000      .208959    .3906225
          ability |          1  (constrained)
            _cons |   .1528852   .0373432     4.09   0.000      .079694    .2260765
------------------+----------------------------------------------------------------
std_asvabwk       |
            black |  -.9383043   .0583691   -16.08   0.000    -1.052706    -.823903
         hispanic |  -.7523568   .0617433   -12.19   0.000    -.8733715   -.6313421
           female |     .04985   .0475141     1.05   0.294     -.043276     .142976
          ability |          1  (constrained)
            _cons |   .3447349   .0382864     9.00   0.000      .269695    .4197748
------------------+----------------------------------------------------------------
logwage           |
            black |   -.186645   .0248389    -7.51   0.000    -.2353283   -.1379616
         hispanic |  -.0800585   .0264423    -3.03   0.002    -.1318844   -.0282326
           female |  -.1353438   .0202956    -6.67   0.000    -.1751225    -.095565
          schoolt |  -.0023212   .0049342    -0.47   0.638     -.011992    .0073495
           gradhs |   .1068696   .0495747     2.16   0.031     .0097051    .2040342
          grad4yr |   .2402205   .0280015     8.58   0.000     .1853386    .2951024
          ability |   .1358955   .0152349     8.92   0.000     .1060357    .1657554
            _cons |   2.152792   .0506745    42.48   0.000     2.053472    2.252112
------------------+----------------------------------------------------------------
      var(ability)|          1  (constrained)
------------------+----------------------------------------------------------------
var(e.std_asvabar)|   .2434771   .0089381                      .2265742    .2616411
var(e.std_asvabcs)|   .6289183   .0197247                      .5914228    .6687911
var(e.std_asvabmk)|   .2154989   .0082658                      .1998923    .2323239
var(e.std_asvabno)|   .5284866   .0168963                      .4963867    .5626622
var(e.std_asvabpc)|   .3022962   .0106443                      .2821373    .3238955
var(e.std_asvabwk)|   .3689144   .0125033                      .3452045    .3942528
    var(e.logwage)|   .2191533   .0063083                      .2071316    .2318728
-----------------------------------------------------------------------------------

.          
. * Display results
. estimates store model1

. estimates table model1, star stats(N r2)

------------------------------
    Variable |    model1      
-------------+----------------
std_asvabar  |
       black | -.93632926***  
    hispanic | -.67981746***  
      female | -.01675753     
     ability |          1     
       _cons |   .3618085***  
-------------+----------------
std_asvabcs  |
       black | -.43097372***  
    hispanic | -.44275226***  
      female |  .39941402***  
     ability |          1     
       _cons | -.00301703     
-------------+----------------
std_asvabmk  |
       black | -.80981695***  
    hispanic | -.63766587***  
      female |  .19540461***  
     ability |          1     
       _cons |  .22207973***  
-------------+----------------
std_asvabno  |
       black | -.34188617***  
    hispanic | -.46756585***  
      female |  .25318683***  
     ability |          1     
       _cons |  .05130191     
-------------+----------------
std_asvabpc  |
       black | -.76197903***  
    hispanic | -.59777997***  
      female |  .29979073***  
     ability |          1     
       _cons |  .15288524***  
-------------+----------------
std_asvabwk  |
       black | -.93830427***  
    hispanic |  -.7523568***  
      female |  .04984997     
     ability |          1     
       _cons |  .34473491***  
-------------+----------------
logwage      |
       black | -.18664496***  
    hispanic | -.08005848**   
      female | -.13534376***  
     schoolt | -.00232124     
      gradhs |  .10686963*    
     grad4yr |  .24022052***  
     ability |   .1358955***  
       _cons |  2.1527922***  
-------------+----------------
 var(ability)|
       _cons |          1     
-------------+----------------
var(e.std_~r)|
       _cons |  .24347715***  
-------------+----------------
var(e.std_~s)|
       _cons |  .62891834***  
-------------+----------------
var(e.std~mk)|
       _cons |  .21549886***  
-------------+----------------
var(e.std_~o)|
       _cons |  .52848658***  
-------------+----------------
var(e.std_~c)|
       _cons |   .3022962***  
-------------+----------------
var(e.std~wk)|
       _cons |   .3689144***  
-------------+----------------
var(e.logw~e)|
       _cons |  .21915333***  
-------------+----------------
Statistics   |                
           N |       2438     
          r2 |                
------------------------------
Legend: * p<0.05; ** p<0.01; *** p<0.001

. 
end of do-file

. clear 

. exit
